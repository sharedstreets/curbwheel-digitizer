<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Digitizer</title>
		<link rel="stylesheet" href="src/basics.css">
		<!-- <link rel='stylesheet'href='https://handsontable.com/docs/8.0.0/styles/main.css'> -->
		<!-- <link rel='stylesheet'href='https://handsontable.com/docs/8.0.0/styles/prettify-tomorrow.css'> -->
		<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@8.0.0/dist/handsontable.full.min.css">
		<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />		
		<style>

			html {
				overscroll-behavior-x: contain;
			}

			body {
				font-family: Verdana, Helvetica, Arial, sans-serif;
				font-weight: 400
			}

			#dataPanel {
				border-right:1px solid #ccc;
			}
			.section {
				height:33.33333%;
				background:#ccc;
			    position: relative
			}

			.image {
				max-height:500px;
			}

			.image:active {
				max-height: 9999999px
			}

			.sheet {
				width:100%;
				top:50px;
				overflow:hidden;
				bottom:0px;
				position: absolute;
			}

			.half {
				width:50%;
				display: inline-block
			}

			/*custom style overrides*/
			.htUIMultipleSelectHot,
			.htUISelectionControls {
				display:non;
			}
			.HandsontableCopyPaste {
				display:none;
			}

			.handsontable thead th .relative {
				padding:0;
			}
			.handsontable td:not(.listbox).htDimmed {
				background:#f0f0f0;
				user-select: none;
			}

			.handsontable span.colHeader {
				height:35px;
				line-height: 35px
			}
			
			.handsontable .wtBorder.corner {
				transform:scale(1.5);
			}

			.handsontable th,
			.handsontable td,
			.handsontable textare {
				padding: 6px;
			}

			.handsontable .htCheckboxRendererInput {
				margin: 0 auto;
				display: block;
			}
			.handsontable tr:first-child th {
			  vertical-align: bottom;
			}



			.handsontable.listbox tr:hover td, 
			.handsontable.listbox tr td.current {
				background:steelblue;
				color:white;
			}
			.handsontable .htAutocompleteArrow {
				color:steelblue;
				opacity:0.5;
				transform:scale(1.2);
			}

			.htDimmed .htAutocompleteArrow {
				display:none;
			}
			.handsontable th > div.filterHeader {
			  margin-bottom:10px;
			}

			.handsontable th > div.filterHeader > input {
			  box-shadow: none;
			  border: 1px solid #CCC;
			}

			.collapsibleIndicator {
				line-height: 9px;
				transform: translateX(-50%) translateY(-40%) scale(1.5);
				border: none;
				background: white;
				color: #666;
				padding: 2px;
				transition:transform 0.25s;
			}

			.collapsibleIndicator:hover {
				background:#666;
				color:white;
			}

			.invisible {
				opacity:0.75;
			}
			.invisible * {
				opacity:0;
				pointer-events:none;
			}

			.header {
				color:white;
				height:50px;
				/*background:#666;*/
			    line-height: 30px;
			}
			#regulations:after {
				content: 'Select a regulation template above to edit ↗';
				display: block;
    			text-align: center;
    			color:white;
    			font-size:2em;
       			margin: 10% auto;
    			width:50%;
			}

			#timespans:after {
				content: 'Select a timespan template above to edit ↗';
				display: block;
    			color:white;
    			text-align: center;
    			font-size:2em;
    			margin: 10% auto;
    			width:50%;
			}

			.handsontable td.steelblue {
				color:steelblue;
			}

/*			.steelblue:before {
				content:'⬤';
			}*/
			.handsontable td.maroon {
				color:maroon;
			}
			
			.handsontable .htPlaceholder {
				color: #999 !important;
				text-align: left;
				font-style: italic;
			}
		</style>
	</head>
	<body>

		<div class='col6 fullHeight scroll' id='dataPanel'>
			<div class='section'>
				<div class='header p10'>
					Features <div class='fr' id='featureFilter'></div>
				</div>
				<div id='featuresList' class='sheet'>
				</div>
			</div>
			<div class='section invisible' id='regulations' style='background:steelblue;'>
				<div class='header p10'>
					☝ Regulations of <span id='featureIndex'></span>
				</div>
				<div id='regulationsList' class='sheet'>
				</div>
			</div>
			<div class='section invisible' id='timespans' style='background:maroon;'>
				<div class='header p10' >
					☝ Timespans of template "<span id='timeSpanTemplate'></span>"
				</div>
				<div id='timeSpansList' class='sheet'>
				</div>
			</div>
		</div>
		<div class='col6 fullHeight'>
			<div class='halfHeight' id='map'></div>
			<div class='halfHeight p10' id='images' style='overflow:scroll; white-space: nowrap; border-top:1px solid #ccc'>
				<h3>Images</h3>
			</div>		
		</div>
	</body>
	<script src="https://cdn.jsdelivr.net/npm/handsontable@8.0.0/dist/handsontable.full.min.js"></script>
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
	<script src='src/digitizer.js'></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<script>

		var surveyUrl = location.search.replace('?survey=', '') || 'src/sampleOutput.geojson';

		d3.json(surveyUrl, (e,r)=>{
			if (e) alert('Error importing the survey. Ensure the url is valid, preceded by "?survey=" in the url of this page.')
			app.state.data = r;
			app.init.map();
			app.init.ui();
		})	


	</script>
	<script src='src/turf.min.js'></script>
</html>